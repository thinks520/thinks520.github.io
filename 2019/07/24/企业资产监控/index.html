<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        企业资产监控 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/" />
        </div>
        <div class="name">
            <i>thinks</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#子域名监控"><span class="toc-text">子域名监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sublert"><span class="toc-text">sublert</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#teemo-subDomainsBrute"><span class="toc-text">teemo + subDomainsBrute</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ESD"><span class="toc-text">ESD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#公网端口资产"><span class="toc-text">公网端口资产</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap"><span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kunpeng"><span class="toc-text">kunpeng</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        企业资产监控
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2019-07-24 16:06:26</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#安全建设" title="安全建设">安全建设</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <p>监控企业外部域名、端口</p>
<a id="more"></a>
<h2 id="子域名监控"><a href="#子域名监控" class="headerlink" title="子域名监控"></a>子域名监控</h2><p>我的做法是，<br>对大量的SRC厂商列表，用sublert监控，旨在发现新上线业务<br>对针对性的SRC，利用 teemo + subDomainsBrute ，旨在发现更全的业务<br>在渗透中，可以用esd进行收集、优势在支持泛解析域名</p>
<h3 id="sublert"><a href="#sublert" class="headerlink" title="sublert"></a>sublert</h3><p><a href="https://github.com/yassineaboukir/sublert" target="_blank" rel="noopener">https://github.com/yassineaboukir/sublert</a><br>Sublert是一个安全侦察工具，这个工具利用了证书透明原则，利用目标组织的TLS/SSL证书从而监控部署的新子域。<br>在原工具基础上，修改了slack的输出 , 添加title 和server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def GetBanner(domain):</span><br><span class="line">    banner, server = &apos;&apos;, &apos;&apos;</span><br><span class="line">    try:</span><br><span class="line">        url = &apos;https://&apos; + domain</span><br><span class="line">        r = requests.get(url, timeout=10, verify=False, allow_redirects=True)</span><br><span class="line">        encoding = &apos;utf-8&apos;</span><br><span class="line">        if r.encoding == &apos;ISO-8859-1&apos;:</span><br><span class="line">            encodings = requests.utils.get_encodings_from_content(r.text)</span><br><span class="line">            if encodings:</span><br><span class="line">                encoding = encodings[0]</span><br><span class="line">            else:</span><br><span class="line">                encoding = r.apparent_encoding</span><br><span class="line">        encode_content = r.content.decode(encoding, &apos;replace&apos;).encode(&apos;utf-8&apos;, &apos;replace&apos;)</span><br><span class="line">        content = encode_content</span><br><span class="line">        server = r.headers.get(&apos;Server&apos;) if r.headers.get(&apos;Server&apos;)!=None else &apos;&apos;</span><br><span class="line">        m = re.search(r&apos;&lt;title&gt;(.*)&lt;/title&gt;&apos;, content, flags=re.I)</span><br><span class="line">        if m:</span><br><span class="line">            banner = m.group(1)</span><br><span class="line">        r.close()</span><br><span class="line">    except Exception, e:</span><br><span class="line">        pass</span><br><span class="line">        #traceback.print_exc()</span><br><span class="line">    finally:</span><br><span class="line">        return banner, server</span><br></pre></td></tr></table></figure>

<h3 id="teemo-subDomainsBrute"><a href="#teemo-subDomainsBrute" class="headerlink" title="teemo + subDomainsBrute"></a>teemo + subDomainsBrute</h3><p><a href="https://github.com/bit4woo/teemo" target="_blank" rel="noopener">https://github.com/bit4woo/teemo</a><br><a href="https://github.com/lijiejie/subDomainsBrute" target="_blank" rel="noopener">https://github.com/lijiejie/subDomainsBrute</a><br>teemo 中带的subDomainsBrute 模块效率太低，lijiejie大佬在2019-05-19重构了subDomainsBrute，效率颇高，<br>于是整合了这两工具到一起，teemo负责用搜索api获取子域名，subDomainsBrute负责DNS暴力枚举<br>结果处理<br>(1) subDomainsBrute 结果保存在 output/xxx_sub.txt<br>(2) teemo 结果保存在 output/xxx_teemo.txt<br>(3) 重新整合处理后生成在 output/subdomains/xxx.txt<br>(4) 网段信息保存在 output/net/xxx_net.txt</p>
<h3 id="ESD"><a href="#ESD" class="headerlink" title="ESD"></a>ESD</h3><p><a href="https://github.com/FeeiCN/esd" target="_blank" rel="noopener">https://github.com/FeeiCN/esd</a><br>某位大佬也使用了ESD做子域名资产监控 <a href="https://github.com/coco413/Domain-monitor" target="_blank" rel="noopener">https://github.com/coco413/Domain-monitor</a></p>
<h2 id="公网端口资产"><a href="#公网端口资产" class="headerlink" title="公网端口资产"></a>公网端口资产</h2><p>通过上面子域名搜集得到的网段信息, 排除掉 aliyun 、 tengxunyun 、内网地址等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def check_ip(ips): # pass aliyun  tencentyun</span><br><span class="line">    ip_net = []</span><br><span class="line">    scan_ips = []</span><br><span class="line">    for iprange,num in ips.items():</span><br><span class="line">        ip = iprange.split(&apos;/&apos;)[0]</span><br><span class="line">        try:</span><br><span class="line">            text = requests.get(&apos;https://api.ip.sb/geoip/&#123;0&#125;&apos;.format(ip)).text</span><br><span class="line">            res = json.loads(text)</span><br><span class="line">            if res.has_key(&apos;organization&apos;):</span><br><span class="line">                if res[&apos;organization&apos;].find(&apos;Alibaba&apos;) == -1 and res[&apos;organization&apos;].find(&apos;Tencent&apos;) == -1:</span><br><span class="line">                    res = &#123;&apos;iprange&apos;:iprange,&apos;organization&apos;:res[&apos;organization&apos;],&apos;num&apos;:num&#125;</span><br><span class="line">                    ip_net.append(res)</span><br><span class="line">                    scan_ips.append(iprange)</span><br><span class="line">            else:</span><br><span class="line">                ip_net[iprange] = &quot;null&quot;</span><br><span class="line">        except Exception,e:</span><br><span class="line">            res = &#123;&apos;iprange&apos;:iprange,&apos;organization&apos;:&apos;null&apos;,&apos;num&apos;:num&#125;</span><br><span class="line">            ip_net.append(res)</span><br><span class="line">    return ip_net,scan_ips</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    print(check_ip([&quot;103.79.77.0/24&quot;]))</span><br></pre></td></tr></table></figure>

<p>将整理后的网段 生成 ip 列表 ip.txt</p>
<p>用nmap ping 扫描存活主机并导出 ip_alive.txt</p>
<p>用masscan扫描ip_alive.txt 的开放端口</p>
<p>用nmap 识别 端口对应服务、组件、http title</p>
<p>根据端口对应的服务、组件、http title 调用kunpeng做POC Scan</p>
<p>待补充详情</p>
<h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><h2 id="kunpeng"><a href="#kunpeng" class="headerlink" title="kunpeng"></a>kunpeng</h2>
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = ""
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
